var bindScheduleViewModel=function(n){return function(t,i){function u(n,t,i){return ko.computed({read:function(){return(t()&i)!=0},write:function(n){n?t(t()|i):t(t()&~i)},owner:n})}function s(n,t,i){return arguments.length==2&&(i=function(){return!0}),ko.computed({read:function(){return i()?t().format(f):""},write:function(n){var r=moment(n,[f,o]),i;r.isValid()&&(i=t(),t(r.hours(i.hours()).minutes(i.minutes())))},owner:n})}function l(n,t){return ko.computed({read:function(){return t().format("h:mm A")},write:function(n){var i=moment(n,["HH:mm","hh:mm a","hh:mm A"]),r=t();i.isValid()?(r.hours(i.hours()).minutes(i.minutes()),t(r)):t.notifySubscribers(r)}})}function v(n,t){for(var u,r=[],i=0;i<t.length;i++)u=1<<i,(u&n)!=0&&r.push(t[i]);return r.join(", ")}var f,o,h,c;switch(t.DateFormat){case"DMY":f="DD/MM/YYYY";o="DD-MM-YYYY";break;case"MDY":f="MM/DD/YYYY";o="MM-DD-YYYY";break;case"YMD":f="YYYY/MM/DD";o="YYYY-MM-DD";break;default:f="MM/DD/YYYY";o="MM-DD-YYYY"}h=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];c=["first","second","third","fourth","fifth"];var y=function(){var r=this,o;for(r.dialogId="#"+i,r.allDay=ko.observable(t.AllDay),r.startDateTime=ko.observable(moment(t.StartDate+" "+t.StartTime,f+" HH:mm")),r.displayStartDate=s(r,r.startDateTime),r.displayStartTime=l(r,r.startDateTime),r.saveStartDate=ko.computed(function(){return r.startDateTime().format(f)}),r.saveStartTime=ko.computed(function(){return r.startDateTime().format("HH:mm")}),r.duration=ko.observable(moment.duration(t.Duration,"minutes")),r.endDateTime=ko.computed({read:function(){return moment(r.startDateTime()+r.duration())},write:function(n){r.duration(moment.duration(n-r.startDateTime()))},owner:r}),r.displayEndDate=s(r,r.endDateTime),r.displayEndTime=l(r,r.endDateTime),r.saveEndDate=ko.computed(function(){return r.endDateTime().format(f)}),r.saveEndTime=ko.computed(function(){return r.endDateTime().format("HH:mm")}),r.lastDayOrWeekOfMonth=ko.observable(t.LastDayOrWeek).store(),r.durationIsValid=ko.computed(function(){return r.allDay()?r.duration().asMinutes()>-1440:r.duration().asMinutes()>=0}),r.endValue=ko.observable(t.EndValue).store(),r.terminalDate=ko.observable(moment(t.TerminalDate,f)).store(),r.displayTerminalDate=s(r,r.terminalDate,function(){return r.endValue()==="date"}),r.saveTerminalDate=ko.computed(function(){return r.terminalDate().format(f)}),r.internalOccurrences=ko.observable(t.Occurrences),r.occurrences=ko.computed({read:function(){return r.endValue()==="times"?r.internalOccurrences():""},write:function(n){r.internalOccurrences(n)},owner:r}).store(),r.monthWeek=ko.computed(function(){return Math.ceil(r.startDateTime().date()/7)}),r.dayWeek=ko.computed(function(){return h[r.startDateTime().day()]}),r.ordinalMonthWeek=ko.computed(function(){return c[r.monthWeek()-1]}),r.weeksFromEndOfMonth=ko.computed(function(){var n=r.startDateTime().daysInMonth(),t=r.startDateTime().date();return Math.floor((n-t)/7)}),r.repeat=ko.observable(t.Repeat).store(),r.repeatInterval=ko.observable(t.RepeatInterval).store(),r.repeatType=ko.observable(t.RepeatType).store(),r.repeatDays=ko.observable(t.RepeatDays).store(),r.repeatMonths=ko.observable(t.RepeatMonths).store(),r.repeatWeeks=ko.observable(t.RepeatWeeks).store(),r.repeatUntil=ko.observable(t.RepeatUntil).store(),r.repeatSet=ko.observable(t.Repeat).store(),r.repeatSummaryFinal=ko.observable(""),r.offset=ko.observable(t.Offset).store(),r.repeatIntervalOptions=[],o=1;o<=30;o++)r.repeatIntervalOptions.push(o);r.rptSU=u(r,r.repeatDays,1);r.rptMO=u(r,r.repeatDays,2);r.rptTU=u(r,r.repeatDays,4);r.rptWE=u(r,r.repeatDays,8);r.rptTH=u(r,r.repeatDays,16);r.rptFR=u(r,r.repeatDays,32);r.rptSA=u(r,r.repeatDays,64);r.rptJan=u(r,r.repeatMonths,1);r.rptFeb=u(r,r.repeatMonths,2);r.rptMar=u(r,r.repeatMonths,4);r.rptApr=u(r,r.repeatMonths,8);r.rptMay=u(r,r.repeatMonths,16);r.rptJun=u(r,r.repeatMonths,32);r.rptJul=u(r,r.repeatMonths,64);r.rptAug=u(r,r.repeatMonths,128);r.rptSep=u(r,r.repeatMonths,256);r.rptOct=u(r,r.repeatMonths,512);r.rptNov=u(r,r.repeatMonths,1024);r.rptDec=u(r,r.repeatMonths,2048);r.rptWeek1=u(r,r.repeatWeeks,1);r.rptWeek2=u(r,r.repeatWeeks,2);r.rptWeek3=u(r,r.repeatWeeks,4);r.rptWeek4=u(r,r.repeatWeeks,8);r.rptWeekLst=u(r,r.repeatWeeks,16);r.excludedDate=ko.observable();r.excludedDates=ko.observableArray(t.ExcludedDates.split(",").map(function(n){return moment(n,f)}).filter(function(n){return n.isValid()}));r.selectedExcludedDate=ko.observable();r.addExcludedDate=function(){r.excludedDates.push(moment(r.excludedDate(),f));r.excludedDates(r.excludedDates().sort(function(n,t){return n-t}));r.excludedDate("")};r.removeExcludedDate=function(){r.excludedDates.remove(r.selectedExcludedDate())};r.isValidExcludedDate=ko.computed(function(){var n=r.excludedDate(),t,i;if(n===undefined||n===""||(t=moment(n,f),!t.isValid()))return!1;i=r.excludedDates();for(e in i)if(t-i[e]==0)return!1;return!0});r.formatDate=function(n){return n.format(f)};r.excludedDatesList=ko.computed(function(){return r.excludedDates().map(function(n){return n.format(f)}).join(",")});r.fromEndOfMonth=ko.observable(t.FromEndOfMonth).store();r.fromStartOrEndOfMonth=ko.computed({read:function(){return r.fromEndOfMonth()?"end":"start"},write:function(n){r.fromEndOfMonth(n==="end")},owner:r});r.displayExcludedDates=ko.computed(function(){return r.excludedDates().length>0});r.excludedDatesSize=ko.computed(function(){return Math.min(r.excludedDates().length,5)});r.excludedDateSelected=ko.computed(function(){});r.ordinalDayInMonth=ko.computed(function(){return r.startDateTime().format("Do")});r.repeatSummary=ko.computed(function(){var f,e,u,o;if(!r.repeat())return undefined;var t=r.repeatInterval(),s=r.endValue(),i=r.offset(),n="";switch(r.repeatType()){case"Daily":n=t===1?"Daily":"Every "+t+" days";break;case"Weekly":n=t===1?"Weekly":"Every "+t+" weeks";f=r.repeatDays();f===62?n+=" on weekdays":f!==0&&(n+=" on ",n+=v(f,h));break;case"MonthlyByDay":n=t==1?"Monthly":"Every "+t+" months";r.fromEndOfMonth()?(e=r.startDateTime().daysInMonth()-r.startDateTime().date(),n+=e===0?" on the last day":e===1?" a day from the end of the month":" "+e+" days from the end of the month"):n+=" on the "+r.startDateTime().format("Do");break;case"MonthlyByWeek":n=t===1?"Monthly":"Every "+t+" months";u=r.dayWeek();r.fromEndOfMonth()?(o=r.weeksFromEndOfMonth(),n+=o===0?" on the last "+u:o===1?" on the next to last "+u:" on the "+c[o-1]+" to last "+u):n+=" on the "+r.ordinalMonthWeek()+" "+u;break;case"Yearly":n=(t===1?"Annually":"Every "+t+" years")+(" on "+r.startDateTime().format("MMMM D"));break;default:n="Unknown"}switch(s){case"times":n+=", "+r.occurrences()+" times";break;case"date":n+=", until "+r.terminalDate().format("MMM D, YYYY")}return i!=0&&(n+=i<-1?", "+-i+" days prior":i===-1?", a day prior":i===1?", a day later":", "+i+" days later"),n});r.byMonth=ko.computed(function(){var n=r.repeatType();return n==="MonthlyByDay"||n==="MonthlyByWeek"});r.repeatIntervalUnit=ko.computed(function(){var n="UNKNOWN";switch(r.repeatType()){case"Daily":n="Day";break;case"Weekly":n="Week";break;case"MonthlyByWeek":case"MonthlyByDay":n="Month";break;case"Yearly":n="Year"}return r.repeatInterval()>1&&(n+="s"),n});r.showDays=ko.computed(function(){var n=r.repeatType();return n==="Weekly"});r.showMonths=ko.computed(function(){var n=r.repeatType();return n==="Yearly"});r.editRepeat=function(){return n(r.dialogId).dialog("open"),!0}},r=new y,a=r.startDateTime();return r.working=!1,r.backup={},r.displayStartDate.subscribe(function(n){var t=r.repeatDays();(t==0||(t&t-1)==0)&&r.repeatDays(1<<new Date(n).getDay())}),r.startDateTime.subscribe(function(){r.working||r.repeatSummaryFinal(r.repeatSummary())}),r.repeat.subscribe(function(n){var t=r.repeatSet();n&&r.repeatSet(!0);!t&&n&&r.editRepeat()}),r.endValue.subscribe(function(n){var u=r.repeatType(),i=u==="Daily"||u==="Yearly"?5:35,f=r.repeatInterval(),e,t;switch(n){case"times":r.occurrences(i);break;case"date":e=r.startDateTime();t=moment.duration(0,"days");switch(u){case"Daily":t=moment.duration(i*f,"days");break;case"Weekly":t=moment.duration(i*f*7,"days");break;case"Yearly":t=moment.duration(i*f,"years")}r.terminalDate(moment(e+t))}}),r.repeatDays()===0&&r.repeatDays(1<<a.day()),r.repeatMonths()===0&&r.repeatMonths(1<<a.month()),ko.applyBindings(r),r.repeatSummaryFinal(r.repeatSummary()),{backup:function(){r.working=!0},finish:function(n){n?(r.repeat.commit(),r.repeatSet.commit(),r.repeatInterval.commit(),r.repeatType.commit(),r.repeatDays.commit(),r.repeatMonths.commit(),r.repeatWeeks.commit(),r.repeatUntil.commit(),r.terminalDate.commit(),r.endValue.commit(),r.occurrences.commit(),r.lastDayOrWeekOfMonth.commit(),r.offset.commit(),r.repeatSummaryFinal(r.repeatSummary())):(r.repeat.revert(),r.repeatSet.revert(),r.repeatInterval.revert(),r.repeatType.revert(),r.repeatDays.revert(),r.repeatMonths.revert(),r.repeatWeeks.revert(),r.repeatUntil.revert(),r.endValue.revert(),r.terminalDate.revert(),r.occurrences.revert(),r.lastDayOrWeekOfMonth.revert(),r.offset.revert());r.working=!1},model:function(){return r}}}}(jQuery);